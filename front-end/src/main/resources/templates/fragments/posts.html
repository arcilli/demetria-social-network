<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="UTF-8">
    <title>Posts fragments</title>
</head>

<body>
<!--Stars so an user can vote a post-->
<span th:fragment="rateStarts(noStars, noActiveStars)" class="stars">
    <th:block th:each="i : ${#numbers.sequence(0, noStars-1)}">
        <a th:class="'star-'+${i+1} +' '+|${i<noActiveStars ? 'active' : ''}|" href="#" th:text="${i+1}"></a>
    </th:block>
    </span>

<td th:fragment=createComment(postId) th:if="${newComment != null}">
    <form th:id="${postId} + 'CommForm'" th:action="@{/createComment}" method="post" th:object="${newComment}">
        <input type="text" class="form-control" th:field="*{content}" placeholder="Add comment"/>
        <input type="hidden" name="id" th:value="${postId}"/>
        <br/>
        <button type="submit" class="btn btn-outline-success btn-sm addCommentButton">Add comment</button>
    </form>
</td>

<div th:fragment="displayPost(post)">
    <article class="userPost" th:id="${post.id}">
        <div class="postHeader flex-container">
            <div class="postOwner">
                <span class="image-post">
                <th:block th:replace="user/fragments :: userPhoto(${post.owner})">
                </th:block>
                </span>
                <span th:replace="user/fragments :: userFullName(${post.owner})"></span>
            </div>
            <!--        TODO: better display time from the post (hours, day, m, years), with the same structure of the link-->
            <div class="postCreationDate">
                <a th:href="@{'/posts/' + ${post.id}}">
                    <td th:text="'on ' + ${#dates.format(post.creationDate, 'dd MMM yyyy')}+': '">
                    </td>
                </a>
                <span class="postRanking">Post rank: <span th:text="${post.averageRank}"></span></span>
            </div>
            <th:block th:if="${session.user != null and session.user.id == post.ownerId}">
                <button type="button" class="btn btn-link btn-sm deletePostButton">Delete
                    post
                </button>
            </th:block>
        </div>
        <div class="postContent" th:text="${post.content}"></div>
        <th:block th:if="${null != session.user}">
            <th:block th:if="${null != post.voteList AND post.voteList.get(0).ownerId == session.user.id}">
                <td>
                    <span th:replace="fragments/posts :: rateStarts(5, ${post.voteList.get(0).value})"></span>
                </td>
            </th:block>
            <th:block th:unless="${null !=post.voteList AND post.voteList.get(0).ownerId== session.user.id}">
                <td>
                    <span th:replace="fragments/posts :: rateStarts(5, 0)"></span>
                </td>
            </th:block>
            <br/>
            <div class="postComments">
                <div class="postComment " th:each="comment : ${post.commentList}">
                    <div>
                        <a th:href="@{'/profiles/' + ${comment.owner.userName}}"
                           th:text="${post.owner.firstName}+' '+${post.owner.lastName}"></a>
                        <span th:text="': '+${comment.content}"></span>
                    </div>
                </div>
                <div>
                    <form th:replace="fragments/posts :: createComment(${post.id})"></form>
                </div>
            </div>
        </th:block>
        <hr/>
    </article>
</div>

<div th:fragment="noMorePosts">
    <article class="userPost" id="noMorePosts">
        <div>No more posts. :(</div>
    </article>
</div>
</body>
</html>
